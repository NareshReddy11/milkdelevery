<!doctype html>
<html><head><meta charset="utf-8"/><title>My Orders</title><link rel="stylesheet" href="/static/style.css"/></head>
<body>
  <div class="container">
    <div class="header"><div class="brand">Shanthi Farms</div></div>
    <h3>My Orders</h3>
    <div>
      <div th:each="o : ${orders}">
        <div class="card">
          <div>Order Date: <span th:text="${o.orderDate}"></span></div>
          <div>Delivery Date: <span th:text="${o.deliveryDate}"></span></div>
          <div>Liters: <span th:text="${o.liters}"></span></div>
          <div>Status: <span th:text="${o.status}"></span></div>
          <div>Payment: <span th:text="${o.paymentStatus}"></span></div>
        </div>
      </div>
    </div>
    <h3>Upcoming Deliveries</h3>
    <div>
      <div th:each="r : ${records}">
        <div class="card">
          <div th:text="${r.deliveryDate}"></div>
          <div>Liters: <span th:text="${r.milkPlan.litersPerDay}"></span></div>
          <div>Status: <span class="badge" th:text="${r.status}"></span></div>
          <div th:if="${r.status} == 'PENDING' and ${r.deliveryDate} == ${#dates.format(#dates.createNow().plusDays(1), 'yyyy-MM-dd')}">
            <button onclick="skipDelivery([[${r.id}]])">Pause/Skip Tomorrow</button>
          </div>
        </div>
      </div>
    </div>
    <h3>Place New Order</h3>
    <form action="/orders/place" method="post">
      <label for="plan">Select Plan:</label>
      <select name="planId" id="plan" required>
        <option th:each="p : ${activePlans}" th:value="${p.id}" th:text="${p.subscriptionType + ' - ' + p.litersPerDay + 'L/day'}"></option>
      </select>
      <label for="deliveryDate">Delivery Date:</label>
      <input type="date" name="deliveryDate" id="deliveryDate" required>
      <label for="liters">Liters:</label>
      <input type="number" name="liters" id="liters" min="0.1" step="0.1" required>
      <button type="submit">Place Order</button>
    </form>
    <div style="margin-top:12px;"><a href="/home">Back</a></div>
  </div>
  <script>
  function skipDelivery(id) {
    fetch('/orders/' + id + '/skip', {method: 'PATCH'})
      .then(resp => resp.text())
      .then(msg => { alert(msg); location.reload(); });
  }
  </script>
</body></html>
